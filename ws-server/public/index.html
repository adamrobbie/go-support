<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebSocket Test Client</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    
    h1 {
      color: #333;
    }
    
    #status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    
    .connected {
      background-color: #d4edda;
      color: #155724;
    }
    
    .disconnected {
      background-color: #f8d7da;
      color: #721c24;
    }
    
    #messages {
      height: 300px;
      overflow-y: auto;
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
    }
    
    .message {
      margin-bottom: 8px;
      padding: 8px;
      border-radius: 4px;
    }
    
    .received {
      background-color: #e9ecef;
    }
    
    .sent {
      background-color: #d1ecf1;
      text-align: right;
    }
    
    .notification {
      background-color: #fff3cd;
      color: #856404;
    }
    
    .error {
      background-color: #f8d7da;
      color: #721c24;
    }
    
    .welcome {
      background-color: #d4edda;
      color: #155724;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
    }
    
    input, select, button {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    button {
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }
    
    button:hover {
      background-color: #0069d9;
    }
    
    .controls {
      display: flex;
      gap: 10px;
    }
    
    .controls button {
      flex: 1;
    }
  </style>
</head>
<body>
  <h1>WebSocket Test Client</h1>
  
  <div id="status" class="disconnected">Disconnected</div>
  
  <div class="form-group">
    <label for="serverUrl">Server URL:</label>
    <input type="text" id="serverUrl" value="ws://localhost:8080" style="width: 300px;">
    <button id="connectBtn">Connect</button>
    <button id="disconnectBtn" disabled>Disconnect</button>
  </div>
  
  <div id="messages"></div>
  
  <div class="form-group">
    <label for="messageType">Message Type:</label>
    <select id="messageType">
      <option value="chat">Chat</option>
      <option value="ping">Ping</option>
      <option value="custom">Custom</option>
    </select>
  </div>
  
  <div class="form-group">
    <label for="messageContent">Message:</label>
    <input type="text" id="messageContent" style="width: 70%;" placeholder="Type your message here...">
    <button id="sendBtn" disabled>Send</button>
  </div>
  
  <div class="controls">
    <button id="clearBtn">Clear Messages</button>
  </div>
  
  <script>
    // DOM Elements
    const statusEl = document.getElementById('status');
    const messagesEl = document.getElementById('messages');
    const serverUrlEl = document.getElementById('serverUrl');
    const connectBtn = document.getElementById('connectBtn');
    const disconnectBtn = document.getElementById('disconnectBtn');
    const messageTypeEl = document.getElementById('messageType');
    const messageContentEl = document.getElementById('messageContent');
    const sendBtn = document.getElementById('sendBtn');
    const clearBtn = document.getElementById('clearBtn');
    
    // WebSocket instance
    let ws = null;
    
    // Connect to WebSocket server
    connectBtn.addEventListener('click', () => {
      const serverUrl = serverUrlEl.value.trim();
      if (!serverUrl) {
        addMessage('Please enter a server URL', 'error');
        return;
      }
      
      try {
        ws = new WebSocket(serverUrl);
        
        ws.onopen = () => {
          statusEl.textContent = 'Connected';
          statusEl.className = 'connected';
          connectBtn.disabled = true;
          disconnectBtn.disabled = false;
          sendBtn.disabled = false;
          addMessage('Connected to server', 'notification');
        };
        
        ws.onmessage = (event) => {
          try {
            const data = JSON.parse(event.data);
            let messageClass = 'received';
            
            if (data.type === 'notification') {
              messageClass = 'notification';
            } else if (data.type === 'error') {
              messageClass = 'error';
            } else if (data.type === 'welcome') {
              messageClass = 'welcome';
            }
            
            addMessage(JSON.stringify(data, null, 2), messageClass);
          } catch (error) {
            addMessage(`Received: ${event.data}`, 'received');
          }
        };
        
        ws.onclose = () => {
          statusEl.textContent = 'Disconnected';
          statusEl.className = 'disconnected';
          connectBtn.disabled = false;
          disconnectBtn.disabled = true;
          sendBtn.disabled = true;
          addMessage('Disconnected from server', 'notification');
          ws = null;
        };
        
        ws.onerror = (error) => {
          addMessage(`WebSocket Error: ${error.message || 'Unknown error'}`, 'error');
        };
      } catch (error) {
        addMessage(`Failed to connect: ${error.message}`, 'error');
      }
    });
    
    // Disconnect from WebSocket server
    disconnectBtn.addEventListener('click', () => {
      if (ws) {
        ws.close();
      }
    });
    
    // Send message to WebSocket server
    sendBtn.addEventListener('click', () => {
      if (!ws) {
        addMessage('Not connected to server', 'error');
        return;
      }
      
      const messageType = messageTypeEl.value;
      const messageContent = messageContentEl.value.trim();
      
      if (!messageContent) {
        addMessage('Please enter a message', 'error');
        return;
      }
      
      let message = {};
      
      if (messageType === 'chat') {
        message = {
          type: 'chat',
          message: messageContent
        };
      } else if (messageType === 'ping') {
        message = {
          type: 'ping'
        };
      } else {
        try {
          // Try to parse as JSON if it's a custom message
          if (messageContent.startsWith('{') && messageContent.endsWith('}')) {
            message = JSON.parse(messageContent);
          } else {
            message = {
              type: 'custom',
              message: messageContent
            };
          }
        } catch (error) {
          message = {
            type: 'custom',
            message: messageContent
          };
        }
      }
      
      try {
        ws.send(JSON.stringify(message));
        addMessage(JSON.stringify(message, null, 2), 'sent');
        messageContentEl.value = '';
      } catch (error) {
        addMessage(`Failed to send message: ${error.message}`, 'error');
      }
    });
    
    // Clear messages
    clearBtn.addEventListener('click', () => {
      messagesEl.innerHTML = '';
    });
    
    // Add message to messages container
    function addMessage(message, className) {
      const messageEl = document.createElement('div');
      messageEl.className = `message ${className}`;
      messageEl.textContent = message;
      messagesEl.appendChild(messageEl);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }
    
    // Allow sending message with Enter key
    messageContentEl.addEventListener('keypress', (event) => {
      if (event.key === 'Enter') {
        sendBtn.click();
      }
    });
  </script>
</body>
</html> 